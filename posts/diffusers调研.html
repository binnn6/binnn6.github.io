<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?1e5df434fabac33eae220777ebe00989";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-KY0TYQ5ZPJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KY0TYQ5ZPJ');
</script>
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.428571; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-variant-alternates: inherit; font-variant-ligatures: inherit; font-variant-numeric: inherit; font-variant-east-asian: inherit; font-variant-position: inherit; font-feature-settings: inherit; font-optical-sizing: inherit; font-variation-settings: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; border-right-style: none; border-right-color: currentcolor; background-color: inherit; }
.CodeMirror-linenumber { -webkit-user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: medium; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: medium !important; border-style: none !important; border-color: currentcolor !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; border-bottom-style: none; border-bottom-color: currentcolor; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: medium; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: "ï„¥"; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: "ï„£"; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: "ï„£"; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "âˆ’"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: medium !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    pre {
        page-break-inside: avoid;
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}


 @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}} .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} h1,h2,h3,h4,h5 {white-space:pre-line}
</style><title>diffusersè°ƒç ”</title>
</head>
<body class='typora-export typora-export-show-outline typora-export-no-collapse-outline'><div class='typora-export-content'>
<div class="typora-export-sidebar"><div class="outline-content"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ğŸ¤—--dğŸ§¨-ffusersè°ƒç ”">ğŸ¤—  DğŸ§¨ ffusersè°ƒç ”</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#stable-diffusionåŸºæœ¬æ¦‚å¿µä¸åŸç†">Stable DiffusionåŸºæœ¬æ¦‚å¿µä¸åŸç†</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#clip-text-encoder">CLIP text-encoder</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#æ¨¡å‹">æ¨¡å‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#é‡‡æ ·å™¨">é‡‡æ ·å™¨</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#vae">VAE</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#diffusersåº“">diffusersåº“</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ç®€å•çš„å®ä¾‹">ç®€å•çš„å®ä¾‹</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#æ¦‚å¿µschedulers-ä¸-models">æ¦‚å¿µï¼šSchedulers ä¸ Models </a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#diffusersä»£ç ç»“æ„">diffusersä»£ç ç»“æ„</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#diffusersæ ¸å¿ƒé€»è¾‘">diffusersæ ¸å¿ƒé€»è¾‘</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#stable-diffusionåŠ è½½æ¨¡å‹åˆå§‹åŒ–-pipeline">Stable DiffusionåŠ è½½æ¨¡å‹ã€åˆå§‹åŒ– pipeline</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#diffusionpipelinefrompretrained">DiffusionPipeline.from_pretrained()</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#fromcpkt">from_cpkt</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#pipelineæ‰§è¡Œæ¨ç†">pipeline()æ‰§è¡Œæ¨ç† </a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¦‚ä½•ç”Ÿæˆä¸stable-diffusion-webuiç›¸åŒçš„ç»“æœ">å¦‚ä½•ç”Ÿæˆä¸stable-diffusion-webuiç›¸åŒçš„ç»“æœ</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#åŸºæœ¬åŠŸèƒ½">åŸºæœ¬åŠŸèƒ½</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¤æ‚ä¸€äº›çš„æç¤ºè¯">å¤æ‚ä¸€äº›çš„æç¤ºè¯</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#loraæ”¯æŒ">LoRAæ”¯æŒ</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å•loraæ”¯æŒ">å•LoRAæ”¯æŒ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å¤šloraæ”¯æŒ">å¤šLoRAæ”¯æŒ</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#é¢éƒ¨ä¿®å¤---codeformer">é¢éƒ¨ä¿®å¤ - CodeFormer</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#hiresfix">Hires.fix</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#sd-webuiæ˜¯å¦‚ä½•å®ç°hiresfixçš„">sd webuiæ˜¯å¦‚ä½•å®ç°Hires.fixçš„?</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#diffusersä¸­åº”è¯¥å¦‚ä½•å®ç°">diffusersä¸­åº”è¯¥å¦‚ä½•å®ç°</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ç›¸å¯¹äºsd-webuiçš„ä¼˜ç¼ºç‚¹">ç›¸å¯¹äºsd webuiçš„ä¼˜ç¼ºç‚¹</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#å†™åœ¨æœ€å">å†™åœ¨æœ€å</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#é™„1-stable-diffusion-webui--diffuserså®‰è£…">é™„1 stable diffusion webui &amp;&amp; diffuserså®‰è£…</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#é™„2-å¼€å‘ç¯å¢ƒ">é™„2 å¼€å‘ç¯å¢ƒ</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#é™„3-ä¸€äº›å‚è€ƒé“¾æ¥">é™„3 ä¸€äº›å‚è€ƒé“¾æ¥</a></div><ul class="outline-children"></ul></li></div></div><div id='write'  class=' first-line-indent'><h2 id='ğŸ¤—--dğŸ§¨-ffusersè°ƒç ”'><span>ğŸ¤—  DğŸ§¨ ffusersè°ƒç ”</span></h2><blockquote><p><span>ç”±äºæœ¬äººéç®—æ³•èƒŒæ™¯ã€æœ¬æ–‡æœªæè¿°ä»»ä½•ç®—æ³•åŸç†ã€å°½ç®¡å¦‚æ­¤ï¼Œè¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šåœ°æ–¹è¯´çš„å¯èƒ½ä¸æ­£ç¡®ï¼Œæœ‰ä»»ä½•é—®é¢˜éƒ½æ¬¢è¿æŒ‡æ­£ã€‚</span></p></blockquote><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1367"><a class="md-toc-inner" href="#ğŸ¤—--dğŸ§¨-ffusersè°ƒç ”">ğŸ¤—  DğŸ§¨ ffusersè°ƒç ”</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1372"><a class="md-toc-inner" href="#stable-diffusionåŸºæœ¬æ¦‚å¿µä¸åŸç†">Stable DiffusionåŸºæœ¬æ¦‚å¿µä¸åŸç†</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1389"><a class="md-toc-inner" href="#clip-text-encoder">CLIP text-encoder</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1397"><a class="md-toc-inner" href="#æ¨¡å‹">æ¨¡å‹</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1401"><a class="md-toc-inner" href="#é‡‡æ ·å™¨">é‡‡æ ·å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1403"><a class="md-toc-inner" href="#vae">VAE</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1409"><a class="md-toc-inner" href="#diffusersåº“">diffusersåº“</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1422"><a class="md-toc-inner" href="#ç®€å•çš„å®ä¾‹">ç®€å•çš„å®ä¾‹</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1424"><a class="md-toc-inner" href="#æ¦‚å¿µschedulers-ä¸-models">æ¦‚å¿µï¼šSchedulers ä¸ Models </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1431"><a class="md-toc-inner" href="#diffusersä»£ç ç»“æ„">diffusersä»£ç ç»“æ„</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1434"><a class="md-toc-inner" href="#diffusersæ ¸å¿ƒé€»è¾‘">diffusersæ ¸å¿ƒé€»è¾‘</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1435"><a class="md-toc-inner" href="#stable-diffusionåŠ è½½æ¨¡å‹åˆå§‹åŒ–-pipeline">Stable DiffusionåŠ è½½æ¨¡å‹ã€åˆå§‹åŒ– pipeline</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1436"><a class="md-toc-inner" href="#diffusionpipelinefrompretrained">DiffusionPipeline.from_pretrained()</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1455"><a class="md-toc-inner" href="#fromcpkt">from_cpkt</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1458"><a class="md-toc-inner" href="#pipelineæ‰§è¡Œæ¨ç†">pipeline()æ‰§è¡Œæ¨ç† </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1475"><a class="md-toc-inner" href="#å¦‚ä½•ç”Ÿæˆä¸stable-diffusion-webuiç›¸åŒçš„ç»“æœ">å¦‚ä½•ç”Ÿæˆä¸stable-diffusion-webuiç›¸åŒçš„ç»“æœ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1484"><a class="md-toc-inner" href="#åŸºæœ¬åŠŸèƒ½">åŸºæœ¬åŠŸèƒ½</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1488"><a class="md-toc-inner" href="#å¤æ‚ä¸€äº›çš„æç¤ºè¯">å¤æ‚ä¸€äº›çš„æç¤ºè¯</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1512"><a class="md-toc-inner" href="#loraæ”¯æŒ">LoRAæ”¯æŒ</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1513"><a class="md-toc-inner" href="#å•loraæ”¯æŒ">å•LoRAæ”¯æŒ</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1528"><a class="md-toc-inner" href="#å¤šloraæ”¯æŒ">å¤šLoRAæ”¯æŒ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1530"><a class="md-toc-inner" href="#é¢éƒ¨ä¿®å¤---codeformer">é¢éƒ¨ä¿®å¤ - CodeFormer</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1536"><a class="md-toc-inner" href="#hiresfix">Hires.fix</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1540"><a class="md-toc-inner" href="#sd-webuiæ˜¯å¦‚ä½•å®ç°hiresfixçš„">sd webuiæ˜¯å¦‚ä½•å®ç°Hires.fixçš„?</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1559"><a class="md-toc-inner" href="#diffusersä¸­åº”è¯¥å¦‚ä½•å®ç°">diffusersä¸­åº”è¯¥å¦‚ä½•å®ç°</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1562"><a class="md-toc-inner" href="#ç›¸å¯¹äºsd-webuiçš„ä¼˜ç¼ºç‚¹">ç›¸å¯¹äºsd webuiçš„ä¼˜ç¼ºç‚¹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1567"><a class="md-toc-inner" href="#å†™åœ¨æœ€å">å†™åœ¨æœ€å</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1571"><a class="md-toc-inner" href="#é™„1-stable-diffusion-webui--diffuserså®‰è£…">é™„1 stable diffusion webui &amp;&amp; diffuserså®‰è£…</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1575"><a class="md-toc-inner" href="#é™„2-å¼€å‘ç¯å¢ƒ">é™„2 å¼€å‘ç¯å¢ƒ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1577"><a class="md-toc-inner" href="#é™„3-ä¸€äº›å‚è€ƒé“¾æ¥">é™„3 ä¸€äº›å‚è€ƒé“¾æ¥</a></span></p></div><p>&nbsp;</p><h2 id='stable-diffusionåŸºæœ¬æ¦‚å¿µä¸åŸç†'><span>Stable DiffusionåŸºæœ¬æ¦‚å¿µä¸åŸç†</span></h2><p><img src="http://devops-1255386119.cos.ap-beijing.myqcloud.com/2023-07-13-053448.png" referrerpolicy="no-referrer" alt="sd-pipeline"></p><p><span>æ–‡ç”Ÿæ¨ç†é˜¶æ®µä¸»è¦æµç¨‹ï¼š</span></p><ol start='' ><li><p><span>ç”Ÿæˆä¸€ä¸ªéšæœºçš„å™ªå£°ï¼Œå¤–åŠ æ ¹æ®promptç”Ÿæˆprompt_embedsï¼›</span></p></li><li><p><span>Stable Diffusionçš„æ ¸å¿ƒé€»è¾‘æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œæ¯ä¸ªå¾ªç¯å°†é™ä½ä¸€äº›å›¾åƒçš„å™ªå£°ï¼Œå°†å›¾åƒå˜çš„æ›´æ¸…æ™°ã€‚å…¶ä¸­æ¯ä¸ªå¾ªç¯ï¼š</span></p></li></ol><ul><li><p><span>å°†å›¾åƒAå’Œclip prompt_embedsè¾“å…¥æ¨¡å‹é¢„æµ‹å™ªå£°æ®‹å·®ï¼Œç„¶åå°†å™ªå£°æ®‹å·®ã€å›¾åƒ Aã€step_no è¾“å…¥é‡‡æ ·å™¨é¢„æµ‹æ›´æ¸…æ™°çš„å›¾åƒB;</span></p></li><li><p><span>å°†å›¾åƒBå’Œclip prompt_embedsè¾“å…¥æ¨¡å‹é¢„æµ‹å™ªå£°æ®‹å·®..å¾ªç¯Næ¬¡,å¾—åˆ°å›¾åƒC</span></p></li></ul><ol start='3' ><li><p><span>æœ€ç»ˆå°†å›¾åƒ C è¾“å…¥ VAE æ¨¡å‹,å¾—åˆ°æ›´åŠ æ¸…æ™°çš„å›¾åƒã€‚</span></p></li></ol><p><span>ä»¥ä¸‹æ˜¯å¯¹æ¶‰åŠæ¨¡å—çš„é€šä¿—è§£é‡Šã€‚</span></p><h3 id='clip-text-encoder'><span>CLIP text-encoder</span></h3><p><span>è¯´ç™½äº†ï¼Œå°±æ˜¯å°†promptè½¬æ¢æˆprompt_embedsï¼Œè€Œè¿™ä¸ªprompt_embedså¯åŒ…å«å›¾åƒç‰¹å¾ã€‚</span></p><blockquote><p><span>CLIP æ˜¯ä¸€ä¸ªå¤šæ¨¡æ€å­¦ä¹ æ¡†æ¶ï¼Œæ¶‰åŠåˆ°åŒæ—¶è®­ç»ƒæ–‡æœ¬ç¼–ç å™¨å’Œå›¾åƒç¼–ç å™¨ã€‚è¿™ç§è”åˆè®­ç»ƒæœ‰åŠ©äºè®©æ–‡æœ¬ç¼–ç å™¨å’Œå›¾åƒç¼–ç å™¨ä¹‹é—´å…±äº«ç›¸åŒçš„è¯­ä¹‰ç©ºé—´ã€‚è¿™ä½¿å¾—å½“æˆ‘ä»¬ä»æ–‡æœ¬ç¼–ç å™¨å¾—åˆ°æ–‡æœ¬çš„å‘é‡è¡¨ç¤ºæ—¶ï¼Œèƒ½å¤Ÿä¸å›¾åƒç¼–ç å™¨ç”Ÿæˆçš„å›¾åƒå‘é‡è¿›è¡Œç›´æ¥æ¯”è¾ƒã€‚</span></p><p><span>å¾—ç›Šäºè¿™ç§è”åˆè®­ç»ƒï¼ŒCLIP æ–‡æœ¬ç¼–ç å™¨å¯ä»¥å¹¿æ³›åº”ç”¨äºå„ç§è‡ªç„¶è¯­è¨€å¤„ç†å’Œå¤šæ¨¡æ€å­¦ä¹ ä»»åŠ¡ï¼Œæ¯”å¦‚å›¾åƒåˆ†ç±»ã€å›¾åƒæ£€ç´¢ã€å›¾åƒç”Ÿæˆç­‰ã€‚é€šè¿‡åˆ©ç”¨æ–‡æœ¬ç¼–ç å™¨ç”Ÿæˆçš„æ–‡æœ¬å‘é‡è¡¨ç¤ºï¼Œæ¨¡å‹èƒ½æ›´å¥½åœ°å…³è”æ–‡æœ¬å’Œå›¾åƒä¿¡æ¯ï¼Œä»è€Œåœ¨è¿™äº›ä»»åŠ¡ä¸­å®ç°é«˜æ€§èƒ½ã€‚            </span></p><p><span>-- GPT4ç”Ÿæˆå†…å®¹</span></p></blockquote><blockquote><p><span>Inspired by </span><a href='https://imagen.research.google/'><span>Imagen</span></a><span>, Stable Diffusion does </span><strong><span>not</span></strong><span> train the text-encoder during training and simply uses an CLIP&#39;s already trained text encoder, </span><a href='https://huggingface.co/docs/transformers/model_doc/clip#transformers.CLIPTextModel'><span>CLIPTextModel</span></a><span>.             --- </span><a href='https://colab.research.google.com/github/huggingface/notebooks/blob/main/diffusers/diffusers_intro.ipynb'><span>diffusers_intro colab</span></a></p></blockquote><h3 id='æ¨¡å‹'><span>æ¨¡å‹</span></h3><p><span>å°†prompt_embedsï¼Œå¸¦å™ªå£°çš„å›¾åƒ è¾“å…¥æ¨¡å‹ æ¨ç†å¾—åˆ° å™ªå£°æ®‹å·®ã€‚å³ model(prompt_embeds, å¸¦å™ªå£°çš„å›¾åƒ) =  å™ªå£°æ®‹å·®</span></p><blockquote><p><span>Without going in too much detail, the model is usually not trained to directly predict a slightly less noisy image, but rather to predict the &quot;noise residual&quot; which is the difference between a less noisy image and the input image (for a diffusion model called &quot;DDPM&quot;) or, similarly, the gradient between the two time steps (like the diffusion model called &quot;Score VE&quot;). </span></p></blockquote><h3 id='é‡‡æ ·å™¨'><span>é‡‡æ ·å™¨</span></h3><p><span>å°†å™ªå£°æ®‹å·®ã€å›¾åƒ ã€æ¨ç†æ­¥éª¤æ•° è¾“å…¥é‡‡æ ·å™¨é¢„æµ‹æ›´æ¸…æ™°çš„å›¾åƒ; å³sample(å™ªå£°æ®‹å·®, æ¨ç†æ­¥éª¤æ•°, å¸¦å™ªå£°çš„å›¾åƒ) = æ›´æ¸…æ™°çš„å›¾åƒ</span></p><h3 id='vae'><span>VAE</span></h3><p><span>å¯ä»¥ç†è§£ä¸ºä¸€ç§å‹ç¼©ç®—æ³•ã€encode å°±æ˜¯å‹ç¼©ã€å°½å¯èƒ½ä¿ç•™å›¾åƒç‰¹å¾çš„åŒæ—¶å‹ç¼©å›¾ç‰‡çš„å¤§å°ï¼Œè¿™æ ·å¤„ç†æ›´å¿«ã€æ›´èŠ‚çœèµ„æºï¼›decode å°±æ˜¯è§£å‹ç¼©ã€æ¢å¤æˆåŸæœ‰çš„å›¾ç‰‡ï¼› è¿™æ˜¯latent diffusionåˆå¿«åˆé«˜æ•ˆçš„å…³é”®æ‰€åœ¨ã€‚</span></p><blockquote><p><span>The VAE model has two parts, an encoder and a decoder. The encoder is used to convert the image into a low dimensional latent representation, which will serve as the input to the U-Net model. The decoder, conversely, transforms the latent representation back into an image.</span></p><p><span>Since latent diffusion operates on a low dimensional space, it greatly reduces the memory and compute requirements compared to pixel-space diffusion models. For example, the autoencoder used in Stable Diffusion has a reduction factor of 8. This means that an image of shape </span><code>(3, 512, 512)</code><span> becomes </span><code>(3, 64, 64)</code><span> in latent space, which requires </span><code>8 Ã— 8 = 64</code><span> times less memory.</span></p></blockquote><p><img src="http://devops-1255386119.cos.ap-beijing.myqcloud.com/2023-07-13-053444.png" alt="img" style="zoom:67%;" /></p><h2 id='diffusersåº“'><span>diffusersåº“</span></h2><p><span>å½“å‰aigcæ¦‚å¿µç«çƒ­ï¼Œaiç»˜ç”»ä½œä¸ºå…¶ä¸­çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œéšç€stable diffusionçš„å¼€æºï¼Œå¤§å®¶çº·çº·å¼€å§‹</span><strong><span>è‡ªç ”</span></strong><span>ã€‚ç›®å‰æ¯”è¾ƒçƒ­é—¨çš„å¼€æºé¡¹ç›®æœ‰ï¼š</span></p><p><a href='https://github.com/AUTOMATIC1111/stable-diffusion-webui'><span>Automatic1111 Stable Diffusion WebUI</span></a></p><p><a href='https://github.com/comfyanonymous/ComfyUI'><span>ComfyUI</span></a></p><p><a href='https://github.com/invoke-ai/InvokeAI'><span>InvokeAI</span></a></p><p><span>å…¶ä¸­æœ€ä¸ºç«çƒ­çš„æ˜¯</span><a href='https://github.com/AUTOMATIC1111/stable-diffusion-webui'><span>Automatic1111 Stable Diffusion WebUI</span></a><span>ï¼ŒåŠŸèƒ½ä¹Ÿæ˜¯æœ€é½å…¨çš„ï¼Œä¸è¿‡ä»£ç ç»“æ„å’Œé£æ ¼å¯¼è‡´å…¶ä¸å¤ªåˆé€‚è‡ªç ”(äºŒæ¬¡å¼€å‘)ã€‚å› æ­¤å°±æƒ³çœ‹æœ‰æ²¡æœ‰æ›´é€‚åˆäºŒæ¬¡å¼€å‘çš„é¡¹ç›®ã€‚</span></p><p><span>ä¸€ç§æ–¹å¼æ˜¯åƒAutomatic1111 Stable Diffusion WebUIä¸€æ ·ï¼Œç›´æ¥åŸºäº</span><a href='https://github.com/CompVis/stable-diffusion'><span>CompVis/stable-diffusion</span></a><span>ã€</span><a href='https://github.com/runwayml/stable-diffusion'><span>runwayml/stable-diffusion</span></a><span>ã€</span><a href='https://github.com/Stability-AI/stablediffusion'><span>Stability-AI/stablediffusion</span></a><span>ã€</span><a href='https://github.com/crowsonkb/k-diffusion'><span>https://github.com/crowsonkb/k-diffusion</span></a><span>ç­‰å¼€æºåº“è¿›è¡Œå¼€å‘ï¼Œè¿™æ ·å·¥ä½œé‡ä¼šéå¸¸å¤§ã€‚</span></p><p><span>è€Œå¦å¤–ä¸€ç§æ–¹å¼æ˜¯åŸºäºdiffusersåº“è¿›è¡Œå¼€å‘ã€‚</span></p><p><span>diffusersæ˜¯huggingfaceå¼€æºçš„ã€ä¸€ä¸ªdiffusion modelsçš„å·¥å…·åº“ï¼ŒåŒ…å«unetã€é‡‡æ ·å™¨ã€vaeç­‰å®ç°ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå°†ç±»ä¼¼æ–‡ç”Ÿå›¾ã€å›¾ç”Ÿå›¾çš„é€»è¾‘æŠ½è±¡æˆpipelineã€‚</span></p><blockquote><p><span>ğŸ¤— Diffusers is the go-to library for state-of-the-art pretrained diffusion models for generating images, audio, and even 3D structures of molecules. </span></p></blockquote><p><span> å¦å¤–</span><a href='https://github.com/invoke-ai/InvokeAI'><span>InvokeAI</span></a><span>çš„åç«¯å·²åˆ‡æ¢ä¸ºæœ‰diffusersé©±åŠ¨ã€‚</span></p><p><span>ä»¥ä¸‹å†…å®¹ä¸»è¦ä»‹ç»diffusersä½¿ç”¨ã€åŸç†åˆ†æä»¥åŠå¦‚ä½•å¤ç°</span><a href='https://github.com/AUTOMATIC1111/stable-diffusion-webui'><span>Automatic1111 Stable Diffusion WebUI</span></a><span>æ‰€æ”¯æŒçš„åŠŸèƒ½ã€‚</span></p><h3 id='ç®€å•çš„å®ä¾‹'><span>ç®€å•çš„å®ä¾‹</span></h3><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.326416px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">diffusers</span> <span class="cm-keyword">import</span> <span class="cm-variable">DiffusionPipeline</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">torch</span> <span class="cm-keyword">import</span> <span class="cm-variable">autocast</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># åŠ è½½æ¨¡å‹é…ç½®ã€åˆå§‹åŒ– pipeline</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span> <span class="cm-operator">=</span> <span class="cm-variable">DiffusionPipeline</span>.<span class="cm-property">from_pretrained</span>(<span class="cm-string">"runwayml/stable-diffusion-v1-5"</span>).<span class="cm-property">to</span>(<span class="cm-string">"cuda"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">prompt</span> <span class="cm-operator">=</span> <span class="cm-string">"a photo of an astronaut riding a horse on mars"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">with</span> <span class="cm-variable">autocast</span>(<span class="cm-string">"cuda"</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># æ‰§è¡Œæ¨ç†ã€StableDiffusionPipelineçš„__call__å‡½æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">image</span> <span class="cm-operator">=</span> <span class="cm-variable">pipeline</span>(<span class="cm-variable">prompt</span>)[<span class="cm-number">0</span>][<span class="cm-number">0</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">image</span>.<span class="cm-property">save</span>(<span class="cm-string">"astronaut_rides_horse.png"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 244px;"></div><div class="CodeMirror-gutters" style="display: none; height: 244px;"></div></div></div></pre><h3 id='æ¦‚å¿µschedulers-ä¸-models'><span>æ¦‚å¿µï¼šSchedulers ä¸ Models </span></h3><p><span>diffusersä¸­çš„ modelsæ˜¯é¢„æµ‹æ®‹å·®ã€è€Œ schedulerså…¶å®å°±æ˜¯ä¸Šæ–‡ä¸­æ‰€è¯´çš„é‡‡æ ·å™¨,ä¸»è¦ä½œç”¨æ˜¯å¢åŠ å™ªå£°ç”¨äºè®­ç»ƒå’Œå°† modelsé¢„æµ‹çš„æ®‹å·®åº”ç”¨åˆ° æœ‰å™ªå£°çš„å›¾åƒä¸Šç”Ÿæˆæ›´æ¸…æ™°çš„å›¾ç‰‡ã€‚(U-Net Model)</span></p><blockquote><p><strong><span>Schedulers</span></strong><span> define the noise schedule which is used to add noise to the model during training, and also define the algorithm to </span><strong><span>compute</span></strong><span> the slightly less noisy sample given the model output (here </span><code>noisy_residual</code><span>). </span></p><p><span>The model </span><strong><span>predict</span></strong><span> the noise residual or slightly less noisy image with its trained weights, while the scheduler </span><strong><span>computes</span></strong><span> the previous sample given the model&#39;s output.</span></p></blockquote><p><span>Schedulersé…ç½®å‚æ•°</span></p><p><span>-</span><span> </span><code>num_train_timesteps</code><span> defines the length of the denoising process, e.g. how many timesteps are need to process random gaussian noise to a data sample.</span></p><h2 id='diffusersä»£ç ç»“æ„'><span>diffusersä»£ç ç»“æ„</span></h2><p><span>diffusersä»£ç ç»“æ„åˆç†ã€ç®€å•ã€å¤–éƒ¨ä¾èµ–å°‘ï¼Œæ˜¯å¼€å‘äººå‘˜äºŒæ¬¡å¼€å‘diffusion modelsçš„é¦–é€‰ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.326416px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ docs</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ examples</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ Makefile</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ MANIFEST.in</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ README.md</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ scripts</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ setup.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ src</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â””â”€â”€ diffusers</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”œâ”€â”€ commands</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”œâ”€â”€ models æ¨¡å‹å®ç°ç›¸å…³ç±»ï¼Œå¦‚ unetã€vae</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ activations.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ attention_processor.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ attention.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ autoencoder_kl.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ controlnet.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ cross_attention.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ dual_transformer_2d.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ embeddings.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ __init__.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ modeling_flax_pytorch_utils.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ modeling_flax_utils.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ modeling_utils.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ prior_transformer.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ resnet.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ t5_film_transformer.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ transformer_2d.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ transformer_temporal.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unet_1d_blocks.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unet_1d.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unet_2d_blocks_flax.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unet_2d_blocks.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unet_2d_condition_flax.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unet_2d_condition.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unet_2d.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unet_3d_blocks.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unet_3d_condition.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ vae.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â””â”€â”€ vq_model.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”œâ”€â”€ pipelines ä»»åŠ¡é€»è¾‘æŠ½è±¡å±‚</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ audio_diffusion</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ controlnet</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ dance_diffusion</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ ddim</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ ddpm</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ kandinsky</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ latent_diffusion</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ latent_diffusion_uncond</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ repaint</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ score_sde_ve</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ semantic_stable_diffusion</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ spectrogram_diffusion</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ stable_diffusion</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ stable_diffusion_safe</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ text_to_video_synthesis</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unclip</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ unidiffuser</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ versatile_diffusion</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â””â”€â”€ vq_diffusion</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”œâ”€â”€ schedulers  å¯¹åº”sd webuiçš„é‡‡æ ·å™¨</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ __init__.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ README.md</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_ddim_flax.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_ddim.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_ddpm.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_dpmsolver_sde.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_euler_ancestral_discrete.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_euler_discrete.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_heun_discrete.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_ipndm.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_karras_ve.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_k_dpm_2_ancestral_discrete.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_k_dpm_2_discrete.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_lms_discrete.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_pndm.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_repaint.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_sde_ve.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_sde_vp.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_unclip.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â”œâ”€â”€ scheduling_utils.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â”‚ &nbsp; â””â”€â”€ scheduling_vq_diffusion.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; &nbsp; &nbsp; â””â”€â”€ utils</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ tests</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ models</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ pipelines</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â””â”€â”€ schedulers</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ _typos.toml</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â””â”€â”€ utils</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1956px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1956px;"></div></div></div></pre><h2 id='diffusersæ ¸å¿ƒé€»è¾‘'><span>diffusersæ ¸å¿ƒé€»è¾‘</span></h2><h3 id='stable-diffusionåŠ è½½æ¨¡å‹åˆå§‹åŒ–-pipeline'><span>Stable DiffusionåŠ è½½æ¨¡å‹ã€åˆå§‹åŒ– pipeline</span></h3><h4 id='diffusionpipelinefrompretrained'><span>DiffusionPipeline.from_pretrained()</span></h4><p><span>ä¸‹è½½æˆ–è€…ä½¿ç”¨æœ¬åœ°çš„æ¨¡å‹ã€æ ¹æ®model_index.jsonåˆå§‹åŒ– pipeline ä»¥åŠå…¶æ‰€éœ€è¦çš„æ¨¡å—</span></p><ol start='' ><li><p><span>ä¸‹è½½æ¨¡å‹æˆ–è€…ç›´æ¥ä½¿ç”¨æœ¬åœ°çš„æ¨¡å‹ï¼›pretrained_model_name_or_path   </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.326416px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">models--runwayml--stable-diffusion-v1-5</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ blobs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 193490b58ef62739077262e833bf091c66c29488058681ac25cf7df3d8190974</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 1a02ee8abc93e840ffbcb2d68b66ccbcb74b3ab3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 1b134cded8eb78b184aefb8805b6b572f36fa77b255c483665dda93</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 2c2130b544c0c5a72d5d00da071ba130a9800fb2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 469be27c5c010538f845f518c4f5e8574c78f7c8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 4d3e873ab5086ad989f407abd50fdce66db8d657</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 5294955ff7801083f720b34b55d0f1f51313c5c5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 55d78924fee13e4220f24320127c5f16284e13b9</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 5ba7bf706515bc60487ad0e1816b4929b82542d6</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 5dbd88952e7e521aa665e5052e6db7def3641d03</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 76e821f1b6f0a9709293c3b6b51ed90980b3166b</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 770a47a9ffdcfda0b05506a7888ed714d06131d60267e6cf52765d61cf59fd67</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ 82d05b0e688d7ea94675678646c427907419346e</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â”œâ”€â”€ c7da0e21ba7ea50637bee26e81c220844defdf01aafca02b2c42ecd</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â””â”€â”€ daf7e2e2dfc64fb437a2b44525667111b00cb9fc</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”œâ”€â”€ refs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â”‚ &nbsp; â””â”€â”€ main</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">â””â”€â”€ snapshots</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  â””â”€â”€ aa9ba505e1973ae5cd05f5aedd345178f52f8e6a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”œâ”€â”€ feature_extractor</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â””â”€â”€ preprocessor_config.json <span class="cm-attribute">-</span>&gt; ../../../blobs/5294955ff7801083f720b34b55d0f1f51313c5c5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”œâ”€â”€ model_index.json <span class="cm-attribute">-</span>&gt; ../../blobs/daf7e2e2dfc64fb437a2b44525667111b00cb9fc</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”œâ”€â”€ safety_checker</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â”œâ”€â”€ config.json <span class="cm-attribute">-</span>&gt; ../../../blobs/5dbd88952e7e521aa665e5052e6db7def3641d03</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â””â”€â”€ pytorch_model.bin <span class="cm-attribute">-</span>&gt; ../../../blobs/193490b58ef62739077262e833bf091c66c29488058681ac25cf7df3d8190974</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”œâ”€â”€ scheduler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â””â”€â”€ scheduler_config.json <span class="cm-attribute">-</span>&gt; ../../../blobs/82d05b0e688d7ea94675678646c427907419346e</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”œâ”€â”€ text_encoder</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â”œâ”€â”€ config.json <span class="cm-attribute">-</span>&gt; ../../../blobs/4d3e873ab5086ad989f407abd50fdce66db8d657</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â””â”€â”€ pytorch_model.bin <span class="cm-attribute">-</span>&gt; ../../../blobs/770a47a9ffdcfda0b05506a7888ed714d06131d60267e6cf52765d61cf59fd67</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”œâ”€â”€ tokenizer</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â”œâ”€â”€ merges.txt <span class="cm-attribute">-</span>&gt; ../../../blobs/76e821f1b6f0a9709293c3b6b51ed90980b3166b</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â”œâ”€â”€ special_tokens_map.json <span class="cm-attribute">-</span>&gt; ../../../blobs/2c2130b544c0c5a72d5d00da071ba130a9800fb2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â”œâ”€â”€ tokenizer_config.json <span class="cm-attribute">-</span>&gt; ../../../blobs/5ba7bf706515bc60487ad0e1816b4929b82542d6</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â””â”€â”€ vocab.json <span class="cm-attribute">-</span>&gt; ../../../blobs/469be27c5c010538f845f518c4f5e8574c78f7c8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”œâ”€â”€ unet</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â”œâ”€â”€ config.json <span class="cm-attribute">-</span>&gt; ../../../blobs/1a02ee8abc93e840ffbcb2d68b66ccbcb74b3ab3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â”‚ &nbsp; â””â”€â”€ diffusion_pytorch_model.bin <span class="cm-attribute">-</span>&gt; ../../../blobs/c7da0e21ba7ea50637bee26e81c220844defdf01aafca02b2c42ecd</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  â””â”€â”€ vae</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  â”œâ”€â”€ config.json <span class="cm-attribute">-</span>&gt; ../../../blobs/55d78924fee13e4220f24320127c5f16284e13b9</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  â””â”€â”€ diffusion_pytorch_model.bin <span class="cm-attribute">-</span>&gt; ../../../blobs/1b134cded8eb78b184aefb8805b6b572f36fa77b255c483665dda93</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 956px;"></div><div class="CodeMirror-gutters" style="display: none; height: 956px;"></div></div></div></pre></li><li><p><span>åŠ è½½æ¨¡å‹ä¸‹ç›®å½•ä¸‹çš„</span><code>model_index.json</code><span>åˆ°</span><code>config_dict</code><span>;</span></p><p><span>å…¶å®ä»è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨è®­ç»ƒæ—¶ï¼Œschedulerã€unetã€text_encoderã€tokenizerã€vaeéƒ½å·²ç»ç¡®å®šäº†ã€‚ä½†å®é™…æ¨ç†é˜¶æ®µï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥æ›´æ¢schedulerï¼ˆé‡‡æ ·å™¨ï¼‰ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.986084px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"_class_name"</span>: <span class="cm-string">"StableDiffusionPipeline"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"_diffusers_version"</span>: <span class="cm-string">"0.6.0"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"feature_extractor"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"transformers"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"CLIPImageProcessor"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"safety_checker"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"stable_diffusion"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"StableDiffusionSafetyChecker"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"scheduler"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"diffusers"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"PNDMScheduler"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"text_encoder"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"transformers"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"CLIPTextModel"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"tokenizer"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"transformers"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"CLIPTokenizer"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"unet"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"diffusers"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"UNet2DConditionModel"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"vae"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"diffusers"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"AutoencoderKL"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 711px;"></div><div class="CodeMirror-gutters" style="display: none; height: 711px;"></div></div></div></pre></li></ol><ol start='3' ><li><p><span>æ ¹æ®</span><code>config_dict[&quot;_class_name&quot;]</code><span>åŠ è½½å¯¹åº”çš„pipeline class;</span></p></li><li><p><span>æ ¹æ®</span><code>model_index.json</code><span>è®¡ç®—åˆå§‹åŒ–ç®¡çº¿éœ€è¦çš„moduleï¼›  init_dict, unused_kwargs, _ = pipeline_class.extract_init_dict(config_dict, **kwargs)</span></p></li><li><p><span>åŠ è½½ pipeline éœ€è¦çš„ model, ä½œä¸ºåˆå§‹åŒ– pipeline çš„å‚æ•°init_kwargsï¼›</span></p></li><li><p><span>åˆå§‹åŒ– pipelineï¼Œå³è°ƒç”¨</span><code>StableDiffusionPipeline.__init</code><span>__</span></p></li></ol><h4 id='fromcpkt'><span>from_cpkt</span></h4><p><span>æ”¯æŒåŠ è½½safetensorsæ–‡ä»¶</span></p><h3 id='pipelineæ‰§è¡Œæ¨ç†'><span>pipeline()æ‰§è¡Œæ¨ç† </span></h3><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.986084px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">__call__</span>(</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">prompt</span>: <span class="cm-variable">Union</span>[<span class="cm-builtin">str</span>, <span class="cm-variable">List</span>[<span class="cm-builtin">str</span>]] <span class="cm-operator">=</span> <span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">height</span>: <span class="cm-variable">Optional</span>[<span class="cm-builtin">int</span>] <span class="cm-operator">=</span> <span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">width</span>: <span class="cm-variable">Optional</span>[<span class="cm-builtin">int</span>] <span class="cm-operator">=</span> <span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_inference_steps</span>: <span class="cm-builtin">int</span> <span class="cm-operator">=</span> <span class="cm-number">50</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">guidance_scale</span>: <span class="cm-builtin">float</span> <span class="cm-operator">=</span> <span class="cm-number">7.5</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">negative_prompt</span>: <span class="cm-variable">Optional</span>[<span class="cm-variable">Union</span>[<span class="cm-builtin">str</span>, <span class="cm-variable">List</span>[<span class="cm-builtin">str</span>]]] <span class="cm-operator">=</span> <span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_images_per_prompt</span>: <span class="cm-variable">Optional</span>[<span class="cm-builtin">int</span>] <span class="cm-operator">=</span> <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">eta</span>: <span class="cm-builtin">float</span> <span class="cm-operator">=</span> <span class="cm-number">0.0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">generator</span>: <span class="cm-variable">Optional</span>[<span class="cm-variable">Union</span>[<span class="cm-variable">torch</span>.<span class="cm-property">Generator</span>, <span class="cm-variable">List</span>[<span class="cm-variable">torch</span>.<span class="cm-property">Generator</span>]]] <span class="cm-operator">=</span> <span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">latents</span>: <span class="cm-variable">Optional</span>[<span class="cm-variable">torch</span>.<span class="cm-property">FloatTensor</span>] <span class="cm-operator">=</span> <span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">prompt_embeds</span>: <span class="cm-variable">Optional</span>[<span class="cm-variable">torch</span>.<span class="cm-property">FloatTensor</span>] <span class="cm-operator">=</span> <span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">negative_prompt_embeds</span>: <span class="cm-variable">Optional</span>[<span class="cm-variable">torch</span>.<span class="cm-property">FloatTensor</span>] <span class="cm-operator">=</span> <span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">output_type</span>: <span class="cm-variable">Optional</span>[<span class="cm-builtin">str</span>] <span class="cm-operator">=</span> <span class="cm-string">"pil"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">return_dict</span>: <span class="cm-builtin">bool</span> <span class="cm-operator">=</span> <span class="cm-keyword">True</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">callback</span>: <span class="cm-variable">Optional</span>[<span class="cm-variable">Callable</span>[[<span class="cm-builtin">int</span>, <span class="cm-builtin">int</span>, <span class="cm-variable">torch</span>.<span class="cm-property">FloatTensor</span>], <span class="cm-keyword">None</span>]] <span class="cm-operator">=</span> <span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">callback_steps</span>: <span class="cm-builtin">int</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cross_attention_kwargs</span>: <span class="cm-variable">Optional</span>[<span class="cm-variable">Dict</span>[<span class="cm-builtin">str</span>, <span class="cm-variable">Any</span>]] <span class="cm-operator">=</span> <span class="cm-keyword">None</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  )</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 444px;"></div><div class="CodeMirror-gutters" style="display: none; height: 444px;"></div></div></div></pre><ol start='' ><li><p><span>å‚æ•°æ ¡éªŒã€åˆå§‹åŒ– heightã€widthã€batch_sizeã€prompt_embedsã€timestepsã€latents</span></p></li><li><p><span>å¾ªç¯æ¨ç†\é™å™ª</span></p><ul><li><p><span>å°†å›¾åƒå™ªå£°è¾“å…¥ unetã€unet é¢„æµ‹å™ªå£°æ®‹å·®</span></p></li><li><p><span>å°†å›¾åƒå™ªå£°ã€å™ªå£°æ®‹å·®è¾“å…¥Scheduler(å³é‡‡æ ·å™¨)ç”Ÿæˆæ–°çš„å›¾åƒå™ªå£°</span></p></li><li><p><span>å¾ªç¯ç¬¬ä¸€æ­¥ã€å°†æ–°çš„å›¾åƒå™ªå£°è¾“å…¥ unetï¼› ä¸€ç›´å¾ªç¯num_inference_stepsæ¬¡</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.986084px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 7. Denoising loop</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_warmup_steps</span> <span class="cm-operator">=</span> <span class="cm-builtin">len</span>(<span class="cm-variable">timesteps</span>) <span class="cm-operator">-</span> <span class="cm-variable">num_inference_steps</span> <span class="cm-operator">*</span> <span class="cm-variable-2">self</span>.<span class="cm-property">scheduler</span>.<span class="cm-property">order</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">with</span> <span class="cm-variable-2">self</span>.<span class="cm-property">progress_bar</span>(<span class="cm-variable">total</span><span class="cm-operator">=</span><span class="cm-variable">num_inference_steps</span>) <span class="cm-keyword">as</span> <span class="cm-variable">progress_bar</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">i</span>, <span class="cm-variable">t</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">timesteps</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># expand the latents if we are doing classifier free guidance</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">latent_model_input</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">cat</span>([<span class="cm-variable">latents</span>] <span class="cm-operator">*</span> <span class="cm-number">2</span>) <span class="cm-keyword">if</span> <span class="cm-variable">do_classifier_free_guidance</span> <span class="cm-keyword">else</span> <span class="cm-variable">latents</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">latent_model_input</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">scheduler</span>.<span class="cm-property">scale_model_input</span>(<span class="cm-variable">latent_model_input</span>, <span class="cm-variable">t</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># predict the noise residual</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">noise_pred</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">unet</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">latent_model_input</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">t</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">encoder_hidden_states</span><span class="cm-operator">=</span><span class="cm-variable">prompt_embeds</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cross_attention_kwargs</span><span class="cm-operator">=</span><span class="cm-variable">cross_attention_kwargs</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ).<span class="cm-property">sample</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># perform guidance</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">do_classifier_free_guidance</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">noise_pred_uncond</span>, <span class="cm-variable">noise_pred_text</span> <span class="cm-operator">=</span> <span class="cm-variable">noise_pred</span>.<span class="cm-property">chunk</span>(<span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">noise_pred</span> <span class="cm-operator">=</span> <span class="cm-variable">noise_pred_uncond</span> <span class="cm-operator">+</span> <span class="cm-variable">guidance_scale</span> <span class="cm-operator">*</span> (<span class="cm-variable">noise_pred_text</span> <span class="cm-operator">-</span> <span class="cm-variable">noise_pred_uncond</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># compute the previous noisy sample x_t -&gt; x_t-1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">latents</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">scheduler</span>.<span class="cm-property">step</span>(<span class="cm-variable">noise_pred</span>, <span class="cm-variable">t</span>, <span class="cm-variable">latents</span>, <span class="cm-operator">**</span><span class="cm-variable">extra_step_kwargs</span>).<span class="cm-property">prev_sample</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># call the callback, if provided</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">i</span> <span class="cm-operator">==</span> <span class="cm-builtin">len</span>(<span class="cm-variable">timesteps</span>) <span class="cm-operator">-</span> <span class="cm-number">1</span> <span class="cm-keyword">or</span> ((<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">&gt;</span> <span class="cm-variable">num_warmup_steps</span> <span class="cm-keyword">and</span> (<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">%</span> <span class="cm-variable-2">self</span>.<span class="cm-property">scheduler</span>.<span class="cm-property">order</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">progress_bar</span>.<span class="cm-property">update</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">callback</span> <span class="cm-keyword">is</span> <span class="cm-keyword">not</span> <span class="cm-keyword">None</span> <span class="cm-keyword">and</span> <span class="cm-variable">i</span> <span class="cm-operator">%</span> <span class="cm-variable">callback_steps</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">callback</span>(<span class="cm-variable">i</span>, <span class="cm-variable">t</span>, <span class="cm-variable">latents</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 644px;"></div><div class="CodeMirror-gutters" style="display: none; height: 644px;"></div></div></div></pre></li><li><p><span>vae decodeã€safety checker (å®‰å…¨æ£€æµ‹ã€æ¯”å¦‚é‰´é»„)</span></p></li></ol><h2 id='å¦‚ä½•ç”Ÿæˆä¸stable-diffusion-webuiç›¸åŒçš„ç»“æœ'><span>å¦‚ä½•ç”Ÿæˆä¸</span><a href='https://github.com/AUTOMATIC1111/stable-diffusion-webui'><span>stable-diffusion-webui</span></a><span>ç›¸åŒçš„ç»“æœ</span></h2><p><span>ä»¥ä¸‹caseä¸­ä½¿ç”¨çš„æ¨¡å‹ä¸å‚æ•°</span></p><ul><li><p><span>SD Model: </span><a href='https://civitai.com/models/43331/majicmix-realistic'><span>majicmix-realistic</span></a><span> v6</span></p></li><li><p><span>LoRA Model: </span><a href='https://civitai.com/models/12597'><span>MoXin</span></a><span> v1</span></p></li><li><p><span>é‡‡æ ·å™¨ï¼šEuler A</span></p></li></ul><h3 id='åŸºæœ¬åŠŸèƒ½'><span>åŸºæœ¬åŠŸèƒ½</span></h3><p><span>é’ˆå¯¹äºç®€å•çš„æç¤ºè¯ï¼Œå’Œsd webuiç”Ÿæˆçš„å›¾æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.326416px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">torch</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">torch</span> <span class="cm-keyword">import</span> <span class="cm-variable">autocast</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">diffusers</span> <span class="cm-keyword">import</span> <span class="cm-variable">EulerAncestralDiscreteScheduler</span>,<span class="cm-variable">StableDiffusionPipeline</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">transformers</span> <span class="cm-keyword">import</span> <span class="cm-variable">CLIPImageProcessor</span>, <span class="cm-variable">CLIPProcessor</span>, <span class="cm-variable">CLIPTextModel</span>,<span class="cm-variable">CLIPTokenizer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">compel</span> <span class="cm-keyword">import</span> <span class="cm-variable">Compel</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">diffusers</span>.<span class="cm-property">utils</span> <span class="cm-keyword">import</span> <span class="cm-variable">get_class_from_dynamic_module</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span> <span class="cm-operator">=</span> <span class="cm-variable">StableDiffusionPipeline</span>.<span class="cm-property">from_ckpt</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"/data/stable-diffusion-webui/models/Stable-diffusion/majicmixRealistic_v6.safetensors"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">).<span class="cm-property">to</span>(<span class="cm-string">"cuda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span>.<span class="cm-property">scheduler</span> <span class="cm-operator">=</span> <span class="cm-variable">EulerAncestralDiscreteScheduler</span>.<span class="cm-property">from_config</span>(<span class="cm-variable">pipeline</span>.<span class="cm-property">scheduler</span>.<span class="cm-property">config</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span>.<span class="cm-property">safety_checker</span> <span class="cm-operator">=</span> <span class="cm-keyword">None</span> <span class="cm-operator">//</span> <span class="cm-variable">é»˜è®¤ä¼šå¯ç”¨safety_checker</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">prompt0</span> <span class="cm-operator">=</span> <span class="cm-string">"1girl"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">generator</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">Generator</span>(<span class="cm-variable">device</span><span class="cm-operator">=</span><span class="cm-string">"cuda"</span>).<span class="cm-property">manual_seed</span>(<span class="cm-number">1432216924</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">with</span> <span class="cm-variable">autocast</span>(<span class="cm-string">"cuda"</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">images</span> <span class="cm-operator">=</span> <span class="cm-variable">pipeline</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">prompt0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">512</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">512</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_images_per_prompt</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">generator</span><span class="cm-operator">=</span><span class="cm-variable">generator</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_inference_steps</span><span class="cm-operator">=</span><span class="cm-number">30</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">guidance_scale</span><span class="cm-operator">=</span><span class="cm-number">7</span>).<span class="cm-property">images</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">images</span>[<span class="cm-number">0</span>]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 644px;"></div><div class="CodeMirror-gutters" style="display: none; height: 644px;"></div></div></div></pre><p><img src="http://devops-1255386119.cos.ap-beijing.myqcloud.com/2023-07-13-053520.png" alt="output" style="zoom: 67%;" /></p><h3 id='å¤æ‚ä¸€äº›çš„æç¤ºè¯'><span>å¤æ‚ä¸€äº›çš„æç¤ºè¯</span></h3><p><span>æµ‹è¯•ä¸­ä¸»è¦å‘ç°ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ä¼šå¯¼è‡´å‡ºå›¾ä¸ä¸€è‡´ï¼š</span></p><ul><li><p><span>diffuserså’Œ</span><a href='https://github.com/AUTOMATIC1111/stable-diffusion-webui'><span>stable-diffusion-webui</span></a><span>æç¤ºè¯æƒé‡è¯­æ³•ä¸ä¸€è‡´; </span></p><p><a href='https://huggingface.co/docs/diffusers/main/en/using-diffusers/weighted_prompts'><span>diffusers weighted_prompts</span></a><span> </span></p><p><a href='https://github.com/AUTOMATIC1111/stable-diffusion-webui/wiki/Features#attentionemphasis'><span>sd webui attention emphasis</span></a></p></li><li><p><span>diffusersæœ‰æœ€å¤§ 77æç¤ºè¯tokençš„é™åˆ¶ï¼›</span></p><blockquote><p><span>CLIP (Contrastive Language-Image Pretraining) æ¨¡å‹çš„è¾“å…¥æœ‰ 75 ä¸ª token çš„é™åˆ¶ï¼Œä¸»è¦æ˜¯ç”±äºåœ¨è®­ç»ƒ CLIP æ¨¡å‹æ—¶ï¼Œè®¾è®¡è€…é€‰æ‹©äº†ä¸€ä¸ªå›ºå®šçš„æœ€å¤§åºåˆ—é•¿åº¦ã€‚è¿™ä¸ªé™åˆ¶æœ‰åŠ©äºåœ¨è®¡ç®—æ–¹é¢ä¿æŒæ•ˆç‡ï¼Œå¹¶é™åˆ¶æ¨¡å‹å¤§å°å’Œå†…å­˜ä½¿ç”¨ã€‚</span></p><p><span>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­ï¼Œè¾“å…¥æ•°æ®é€šå¸¸å…·æœ‰ä¸åŒçš„é•¿åº¦å’Œå˜åŒ–ã€‚ä¸ºäº†ç®€åŒ–è®¡ç®—å’Œæé«˜æ•ˆç‡ï¼Œç ”ç©¶äººå‘˜é€šå¸¸ä¼šè®¾å®šä¸€ä¸ªæœ€å¤§åºåˆ—é•¿åº¦ï¼Œä½¿å¾—æ¨¡å‹åœ¨å†…å­˜å’Œè®¡ç®—æœºèƒ½åŠ›èŒƒå›´å†…é«˜æ•ˆè¿è¡Œã€‚å¯¹äº CLIP æ¨¡å‹ï¼Œç ”ç©¶è€…è®¾å®šäº† 75 ä¸ª token çš„æœ€å¤§é•¿åº¦ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ CLIP å¤„ç†æ–‡æœ¬æ•°æ®æ—¶ï¼Œéœ€è¦å°†è¾“å…¥æˆªæ–­æˆ–å¡«å……ä¸º 75 ä¸ª tokenã€‚</span></p><p><span>è¿™ä¸ªé™åˆ¶å¹¶ä¸æ„å‘³ç€ CLIP æ¨¡å‹åªèƒ½å¤„ç†ç”± 75 ä¸ª token æ„æˆçš„æ•°æ®ã€‚åœ¨å®è·µä¸­ï¼Œæ‚¨å¯ä»¥å°†è¾ƒé•¿çš„è¾“å…¥åˆ†å‰²æˆå¤šä¸ªçŸ­æ®µï¼Œå¹¶åˆ†åˆ«å¤„ç†ï¼Œä½†è¿™éœ€è¦é¢å¤–çš„é¢„å¤„ç†æ­¥éª¤ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦ä¸ºè¶…å‡ºé™åˆ¶çš„è¾“å…¥éƒ¨åˆ†é€‰æ‹©æ›´åˆé€‚çš„æˆªæ–­ç­–ç•¥ï¼ˆå¦‚ç¡®ä¿ä¿ç•™è¯­æ³•ç»“æ„å’Œä¸»è¦æ„ä¹‰ï¼‰ã€‚</span></p><p><span>æ€»ä¹‹ï¼ŒCLIP æ¨¡å‹å…·æœ‰ 75 ä¸ª token çš„é™åˆ¶æ˜¯ä¸ºäº†åœ¨è®­ç»ƒå’Œåº”ç”¨é˜¶æ®µä¿æŒå†…å­˜å’Œè®¡ç®—æ•ˆç‡ã€‚è¿™ç§é™åˆ¶åœ¨å®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦æŸäº›é¢å¤–çš„é¢„å¤„ç†å’Œé€‚åº”æ­¥éª¤ã€‚ç„¶è€Œï¼Œé€šè¿‡é€‰æ‹©åˆé€‚çš„æˆªæ–­æˆ–å¡«å……ç­–ç•¥ï¼ŒCLIP æ¨¡å‹ä»ç„¶å¯ä»¥å¹¿æ³›åº”ç”¨äºå„ç§è‡ªç„¶è¯­è¨€å’Œè®¡ç®—æœºè§†è§‰ä»»åŠ¡ã€‚     --- GPT4ç”Ÿæˆå†…å®¹</span></p></blockquote></li></ul><p><span>ç¤¾åŒºç‰ˆæœ¬çš„Stable Diffusionå®ç°äº†ä¸sd webuiä¸€æ ·çš„åŠŸèƒ½ã€‚</span><a href='https://github.com/huggingface/diffusers/blob/main/examples/community/lpw_stable_diffusion.py'><span>Long Prompt Weighting Stable Diffusion community pipeline</span></a></p><p><span>è‡³äºä¸ºä»€ä¹ˆä¸ç›´æ¥åŠ åˆ°StableDiffusionPipelineï¼Œæˆ‘ç†è§£åŸå› æœ‰ä¸¤ä¸ªï¼š</span></p><ol start='' ><li><p><span>diffusersåˆ›å»ºpipelineå¾ˆç®€å•ï¼Œé¼“åŠ±ç”¨æˆ·åˆ›å»ºè‡ªå·±çš„pipelineï¼›</span></p></li><li><p><span>æç¤ºè¯æƒé‡ã€tokenæ•°é™åˆ¶édiffusersçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸”æ²¡å¿…è¦å’Œsd webuiä¿æŒä¸€è‡´ã€‚</span></p></li></ol><p><span>ä»¥ä¸‹ä»£ç ä¸ºä½¿ç”¨diffusers </span><a href='https://github.com/huggingface/diffusers/blob/main/examples/community/lpw_stable_diffusion.py'><span>Long Prompt Weighting Stable Diffusion community pipeline</span></a><span>ç¤ºä¾‹,ç»“æœä¸sd webuiå®Œå…¨ä¸€è‡´ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.326416px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">torch</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">torch</span> <span class="cm-keyword">import</span> <span class="cm-variable">autocast</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">diffusers</span> <span class="cm-keyword">import</span> <span class="cm-variable">EulerAncestralDiscreteScheduler</span>,<span class="cm-variable">StableDiffusionPipeline</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">transformers</span> <span class="cm-keyword">import</span> <span class="cm-variable">CLIPImageProcessor</span>, <span class="cm-variable">CLIPProcessor</span>, <span class="cm-variable">CLIPTextModel</span>,<span class="cm-variable">CLIPTokenizer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">diffusers</span>.<span class="cm-property">utils</span> <span class="cm-keyword">import</span> <span class="cm-variable">get_class_from_dynamic_module</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">stablepipeline</span> <span class="cm-operator">=</span> <span class="cm-variable">StableDiffusionPipeline</span>.<span class="cm-property">from_ckpt</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"/data/stable-diffusion-webui/models/Stable-diffusion/majicmixRealistic_v6.safetensors"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">).<span class="cm-property">to</span>(<span class="cm-string">"cuda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">LPWStableDiffusionPipeline</span> <span class="cm-operator">=</span> <span class="cm-variable">get_class_from_dynamic_module</span>(<span class="cm-string">"lpw_stable_diffusion"</span>, <span class="cm-variable">module_file</span><span class="cm-operator">=</span><span class="cm-string">"lpw_stable_diffusion.py"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span> <span class="cm-operator">=</span> <span class="cm-variable">LPWStableDiffusionPipeline</span>(<span class="cm-operator">**</span><span class="cm-variable">stablepipeline</span>.<span class="cm-property">components</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span>.<span class="cm-property">scheduler</span> <span class="cm-operator">=</span> <span class="cm-variable">EulerAncestralDiscreteScheduler</span>.<span class="cm-property">from_config</span>(<span class="cm-variable">pipeline</span>.<span class="cm-property">scheduler</span>.<span class="cm-property">config</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span>.<span class="cm-property">safety_checker</span> <span class="cm-operator">=</span> <span class="cm-keyword">None</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span>.<span class="cm-property">to</span>(<span class="cm-string">"cuda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">prompt</span> <span class="cm-operator">=</span> <span class="cm-string">"((wallpaper 8k)), ((high detailed)), ((masterpiece)), ((best quality:1.2)), ((hdr)), ((absurdres)), ((RAW photo)), 1girl, green eyes, medium hair, bangs, portrait, upper body, shoulder, shirt, simple background, blue background"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">negative_prompt</span> <span class="cm-operator">=</span> <span class="cm-string">"easynegative,ng_deepnegative_v1_75t, badhandv4,(worst quality:2),(low quality:2),(normal quality:2),lowres,bad anatomy,bad hands,normal quality,((monochrome)),((grayscale)),((watermark)),"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">generator</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">Generator</span>(<span class="cm-variable">device</span><span class="cm-operator">=</span><span class="cm-string">"cuda"</span>).<span class="cm-property">manual_seed</span>(<span class="cm-number">1432216924</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">with</span> <span class="cm-variable">autocast</span>(<span class="cm-string">"cuda"</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">images</span> <span class="cm-operator">=</span> <span class="cm-variable">pipeline</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">prompt</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">512</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">512</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_images_per_prompt</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">generator</span><span class="cm-operator">=</span><span class="cm-variable">generator</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">negative_prompt</span> <span class="cm-operator">=</span> <span class="cm-variable">negative_prompt</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_inference_steps</span><span class="cm-operator">=</span><span class="cm-number">30</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">guidance_scale</span><span class="cm-operator">=</span><span class="cm-number">7</span>).<span class="cm-property">images</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">images</span>[<span class="cm-number">0</span>]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 778px;"></div><div class="CodeMirror-gutters" style="display: none; height: 778px;"></div></div></div></pre><p><img src="http://devops-1255386119.cos.ap-beijing.myqcloud.com/2023-07-13-053525.png" alt="00006-1432216924" style="zoom: 67%;" /></p><h3 id='loraæ”¯æŒ'><span>LoRAæ”¯æŒ</span></h3><h4 id='å•loraæ”¯æŒ'><span>å•LoRAæ”¯æŒ</span></h4><p><span>ç›®å‰å·²å‘å¸ƒç‰ˆæœ¬(diffusers </span><a href='https://github.com/huggingface/diffusers/releases/tag/v0.18.1'><span>v0.18.1</span></a><span>)ä»…æ”¯æŒattention layersï¼Œ æ•ˆæœä¸å¤ªå¥½ã€‚å·²ç»æœ‰äººæäº¤pr </span><a href='https://github.com/huggingface/diffusers/pull/3756'><span>Support to load Kohya-ss style LoRA file format (without restrictions)</span></a><span>,å°šæœªåˆå¹¶ã€‚</span></p><p><span>å½“ç„¶é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å…¶ä»–ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚</span><a href='https://github.com/huggingface/diffusers/issues/4027'><span>Unload lora weights after they have been loaded</span></a></p><blockquote><p><span>Currently, LoRA is only supported for the attention layers of the </span><code>UNet2DConditionalModel</code><span>. We also support fine-tuning the text encoder for DreamBooth with LoRA in a limited capacity. Fine-tuning the text encoder for DreamBooth generally yields better results, but it can increase compute usage.    </span><a href='https://huggingface.co/docs/diffusers/training/lora'><span>Low-Rank Adaptation of Large Language Models (LoRA)</span></a></p></blockquote><blockquote><p><span>Usually, LoRA fine-tuning of the text encoder along with the UNet leads to better results than LoRA fine-tuning the UNet alone. A reference PR that might be relevant here: </span><a href='https://github.com/huggingface/diffusers/pull/3180'><span>#3180</span></a><span>.    </span><a href='https://github.com/huggingface/diffusers/issues/3219'><span>Docs for LoRA are confusing</span></a></p></blockquote><blockquote><p><span>Discussed in </span><a href='https://github.com/huggingface/diffusers/issues/3064#issuecomment-1544159510'><span>#3064 (comment)</span></a><span>, PR </span><a href='https://github.com/huggingface/diffusers/pull/3437'><span>#3437</span></a><span>. In the PR </span><a href='https://github.com/huggingface/diffusers/pull/3437'><span>#3437</span></a><span>, we implemented the loading of Kohya-ss style LoRA, but this was only support for the Attention part, which had already been implemented in Diffusers. Kohya-ss style LoRA is not only extended to Attention, but also to </span><code>ClipMLP</code><span>, </span><code>Transformer2DModel</code><span>&#39;s </span><code>proj_in</code><span>, </span><code>proj_out</code><span>, and so on. This PR will support these remaining issues.</span></p><p><a href='https://github.com/huggingface/diffusers/pull/3756'><span>Support to load Kohya-ss style LoRA file format (without restrictions)</span></a></p></blockquote><blockquote><p><a href='https://github.com/huggingface/diffusers/issues/3725'><span>failed to use the feature of supporting for A1111 LoRA</span></a></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.326416px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">torch</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">torch</span> <span class="cm-keyword">import</span> <span class="cm-variable">autocast</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">diffusers</span> <span class="cm-keyword">import</span> <span class="cm-variable">EulerAncestralDiscreteScheduler</span>,<span class="cm-variable">StableDiffusionPipeline</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">transformers</span> <span class="cm-keyword">import</span> <span class="cm-variable">CLIPImageProcessor</span>, <span class="cm-variable">CLIPProcessor</span>, <span class="cm-variable">CLIPTextModel</span>,<span class="cm-variable">CLIPTokenizer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">compel</span> <span class="cm-keyword">import</span> <span class="cm-variable">Compel</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">diffusers</span>.<span class="cm-property">utils</span> <span class="cm-keyword">import</span> <span class="cm-variable">get_class_from_dynamic_module</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">stablepipeline</span> <span class="cm-operator">=</span> <span class="cm-variable">StableDiffusionPipeline</span>.<span class="cm-property">from_ckpt</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"/data/stable-diffusion-webui/models/Stable-diffusion/majicmixRealistic_v6.safetensors"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">).<span class="cm-property">to</span>(<span class="cm-string">"cuda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">LPWStableDiffusionPipeline</span> <span class="cm-operator">=</span> <span class="cm-variable">get_class_from_dynamic_module</span>(<span class="cm-string">"lpw_stable_diffusion"</span>, <span class="cm-variable">module_file</span><span class="cm-operator">=</span><span class="cm-string">"lpw_stable_diffusion.py"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span> <span class="cm-operator">=</span> <span class="cm-variable">LPWStableDiffusionPipeline</span>(<span class="cm-operator">**</span><span class="cm-variable">stablepipeline</span>.<span class="cm-property">components</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span>.<span class="cm-property">scheduler</span> <span class="cm-operator">=</span> <span class="cm-variable">EulerAncestralDiscreteScheduler</span>.<span class="cm-property">from_config</span>(<span class="cm-variable">pipeline</span>.<span class="cm-property">scheduler</span>.<span class="cm-property">config</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span>.<span class="cm-property">feature_extractor</span> <span class="cm-operator">=</span> <span class="cm-variable">CLIPImageProcessor</span>.<span class="cm-property">from_dict</span>(<span class="cm-variable">pipeline</span>.<span class="cm-property">feature_extractor</span>.<span class="cm-property">to_dict</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span>.<span class="cm-property">safety_checker</span> <span class="cm-operator">=</span> <span class="cm-keyword">None</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pipeline</span>.<span class="cm-property">load_lora_weights</span>(<span class="cm-string">"/data/stable-diffusion-webui/models/Lora"</span>, <span class="cm-variable">weight_name</span><span class="cm-operator">=</span><span class="cm-string">"moxinv1.khzz.safetensors"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">prompt</span> <span class="cm-operator">=</span> <span class="cm-string">"1girl"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">generator</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">Generator</span>(<span class="cm-variable">device</span><span class="cm-operator">=</span><span class="cm-string">"cuda"</span>).<span class="cm-property">manual_seed</span>(<span class="cm-number">1432216924</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">with</span> <span class="cm-variable">autocast</span>(<span class="cm-string">"cuda"</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">images</span> <span class="cm-operator">=</span> <span class="cm-variable">pipeline</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">prompt0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">512</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">512</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_images_per_prompt</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">generator</span><span class="cm-operator">=</span><span class="cm-variable">generator</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_inference_steps</span><span class="cm-operator">=</span><span class="cm-number">30</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cross_attention_kwargs</span><span class="cm-operator">=</span>{<span class="cm-string">"scale"</span>: <span class="cm-number">1</span>},</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">guidance_scale</span><span class="cm-operator">=</span><span class="cm-number">7</span>).<span class="cm-property">images</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">images</span>[<span class="cm-number">0</span>]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 800px;"></div><div class="CodeMirror-gutters" style="display: none; height: 800px;"></div></div></div></pre><center>
<figure>
<img src="http://devops-1255386119.cos.ap-beijing.myqcloud.com/2023-07-13-030013.png" alt="before-face-store-03" style="zoom:67%;" />
<img src="http://devops-1255386119.cos.ap-beijing.myqcloud.com/2023-07-13-025959.png" alt="00018-1432216924" style="zoom:67%;" />
</figure>
</center>
<center>å·¦å›¾ä¸ºdiffusers[v0.18.1]çš„æ•ˆæœï¼Œå³å›¾ä¸ºåº”ç”¨prä¹‹åçš„æ•ˆæœ(ä¸sd webuiå®Œå…¨ä¸€è‡´)</center><h4 id='å¤šloraæ”¯æŒ'><span>å¤šLoRAæ”¯æŒ</span></h4><p><span>å°šæœªæ”¯æŒã€</span><a href='https://github.com/huggingface/diffusers/issues/2613#top'><span>Support for adding multiple LoRA layers to Diffusers</span></a></p><h3 id='é¢éƒ¨ä¿®å¤---codeformer'><span>é¢éƒ¨ä¿®å¤ - CodeFormer</span></h3><p><span>diffusersåº“ä¸­å¹¶ä¸åŒ…å«é¢éƒ¨ä¿®å¤åŠŸèƒ½ã€æŸ¥çœ‹sd webuiæºç å‘ç°å…¶ä¸­é¢éƒ¨ä¿®å¤çš„åŠŸèƒ½æ˜¯ä½¿ç”¨äº†</span><a href='https://github.com/sczhou/CodeFormer'><span>CodeFormer repo</span></a><span>ã€‚ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.326416px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Clone CodeFormer and enter the CodeFormer folder</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">!</span><span class="cm-variable">git</span> <span class="cm-variable">clone</span> <span class="cm-variable">https</span>:<span class="cm-operator">//</span><span class="cm-variable">github</span>.<span class="cm-property">com</span><span class="cm-operator">/</span><span class="cm-variable">sczhou</span><span class="cm-operator">/</span><span class="cm-variable">CodeFormer</span>.<span class="cm-property">git</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">%</span><span class="cm-variable">cd</span> &nbsp;<span class="cm-variable">CodeFormer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Set up the environment</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Install python dependencies</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">!</span><span class="cm-variable">pip</span> <span class="cm-variable">install</span> <span class="cm-operator">-</span><span class="cm-variable">r</span> <span class="cm-variable">requirements</span>.<span class="cm-property">txt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Install basicsr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">!</span><span class="cm-variable">python</span> <span class="cm-variable">basicsr</span><span class="cm-operator">/</span><span class="cm-variable">setup</span>.<span class="cm-property">py</span> <span class="cm-variable">develop</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Download the pre-trained model</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">!</span><span class="cm-variable">python</span> <span class="cm-variable">scripts</span><span class="cm-operator">/</span><span class="cm-variable">download_pretrained_models</span>.<span class="cm-property">py</span> <span class="cm-variable">facelib</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">!</span><span class="cm-variable">python</span> <span class="cm-variable">scripts</span><span class="cm-operator">/</span><span class="cm-variable">download_pretrained_models</span>.<span class="cm-property">py</span> <span class="cm-variable">CodeFormer</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 289px;"></div><div class="CodeMirror-gutters" style="display: none; height: 289px;"></div></div></div></pre><p><span>å°†éœ€è¦ä¿®å¤çš„å›¾åƒæ”¾å…¥inputsç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤åå¾—åˆ°ä¿®å¤åçš„å›¾ç‰‡</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.326416px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Inference the uploaded images</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#@markdown `CODEFORMER_FIDELITY`: Balance the quality (lower number) and fidelity (higher number)&lt;br&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># you can add '--bg_upsampler realesrgan' to enhance the background</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">CODEFORMER_FIDELITY</span> <span class="cm-operator">=</span> <span class="cm-number">0.7</span> <span class="cm-comment">#@param {type:"slider", min:0, max:1, step:0.01}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#@markdown `BACKGROUND_ENHANCE`: Enhance background image with Real-ESRGAN&lt;br&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">BACKGROUND_ENHANCE</span> <span class="cm-operator">=</span> <span class="cm-keyword">True</span> <span class="cm-comment">#@param {type:"boolean"}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#@markdown `FACE_UPSAMPLE`: Upsample restored faces for high-resolution AI-created images&lt;br&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FACE_UPSAMPLE</span> <span class="cm-operator">=</span> <span class="cm-keyword">False</span> <span class="cm-comment">#@param {type:"boolean"}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> <span class="cm-variable">BACKGROUND_ENHANCE</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">FACE_UPSAMPLE</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">!</span><span class="cm-variable">python</span> <span class="cm-variable">inference_codeformer</span>.<span class="cm-property">py</span> <span class="cm-operator">-</span><span class="cm-variable">w</span> <span class="cm-error">$</span><span class="cm-variable">CODEFORMER_FIDELITY</span> <span class="cm-operator">--</span><span class="cm-variable">input_path</span> <span class="cm-variable">inputs</span> <span class="cm-operator">--</span><span class="cm-variable">bg_upsampler</span> <span class="cm-variable">realesrgan</span> <span class="cm-operator">--</span><span class="cm-variable">face_upsample</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">else</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">!</span><span class="cm-variable">python</span> <span class="cm-variable">inference_codeformer</span>.<span class="cm-property">py</span> <span class="cm-operator">-</span><span class="cm-variable">w</span> <span class="cm-error">$</span><span class="cm-variable">CODEFORMER_FIDELITY</span> <span class="cm-operator">--</span><span class="cm-variable">input_path</span> <span class="cm-variable">inputs</span> <span class="cm-operator">--</span><span class="cm-variable">bg_upsampler</span> <span class="cm-variable">realesrgan</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-operator">!</span><span class="cm-variable">python</span> <span class="cm-variable">inference_codeformer</span>.<span class="cm-property">py</span> <span class="cm-operator">-</span><span class="cm-variable">w</span> <span class="cm-error">$</span><span class="cm-variable">CODEFORMER_FIDELITY</span> <span class="cm-operator">--</span><span class="cm-variable">input_path</span> <span class="cm-variable">inputs</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 333px;"></div><div class="CodeMirror-gutters" style="display: none; height: 333px;"></div></div></div></pre><h3 id='hiresfix'><span>Hires.fix</span></h3><p><span>diffusersä¸­çš„é«˜æ¸…ä¿®å¤å¹¶ä¸åƒsd webuié‚£æ ·å”¾æ‰‹å¯å¾—ï¼Œéœ€è¦æˆ‘ä»¬äº†è§£æ¯ä¸ªæ­¥éª¤çš„åŸç†ï¼Œç„¶åç»„åˆä½¿ç”¨ã€‚</span></p><p><a href='https://github.com/huggingface/diffusers/issues/3429'><span>does diffusers have the equivalent to hires fix from A1111?</span></a></p><p><a href='https://github.com/xinntao/Real-ESRGAN'><span>Real-ESRGAN</span></a></p><h4 id='sd-webuiæ˜¯å¦‚ä½•å®ç°hiresfixçš„'><span>sd webuiæ˜¯å¦‚ä½•å®ç°Hires.fixçš„?</span></h4><p><span>txt2imgçš„æ ¸å¿ƒé€»è¾‘ä½äº</span></p><ul><li><p><span>æ–‡ä»¶: processing.py</span></p></li><li><p><span>ç±»:  </span><code>StableDiffusionProcessingTxt2Img(StableDiffusionProcessing)</code><span> </span></p></li><li><p><span>å‡½æ•°: </span><code>sample(self, conditioning, unconditional_conditioning, seeds, subseeds, subseed_strength, prompts</code></p></li></ul><p><img src="http://devops-1255386119.cos.ap-beijing.myqcloud.com/2023-07-13-054317.png" referrerpolicy="no-referrer" alt="image-20230712152457898"></p><p><span>å¦‚ä»£ç æ‰€ç¤ºï¼Œå…¶å®text2img + Hires.fixå…¶å®å°±æ˜¯text2img + upscaler + img2imgã€‚</span></p><p><span>å…¶ä¸­ç‰¹åˆ«æ³¨æ„Upscalerä¸ºlatentæ—¶ï¼Œæ˜¯å°†å›¾åƒé€šè¿‡</span><code>torch.nn.functional.interpolate</code><span>å¤„ç†è·å¾—samplesï¼›</span></p><blockquote><p><code>torch.nn.functional.interpolate</code><span> æ˜¯ä¸€ä¸ª PyTorch å‡½æ•°ï¼Œç”¨äºè°ƒæ•´ï¼ˆæ”¾å¤§æˆ–ç¼©å°ï¼‰å¼ é‡ï¼ˆé€šå¸¸æ˜¯å›¾åƒæˆ–ç‰¹å¾æ˜ å°„ï¼‰çš„å°ºå¯¸ã€‚è¿™ä¸ªå‡½æ•°åœ¨è®¡ç®—æœºè§†è§‰å’Œæ·±åº¦å­¦ä¹ ä»»åŠ¡ä¸­å¾ˆå¸¸è§ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦è°ƒæ•´å›¾åƒæˆ–ç‰¹å¾æ˜ å°„å¤§å°ä»¥é€‚åº”æ¨¡å‹è¾“å…¥è¦æ±‚ã€è¿›è¡Œä¸Šé‡‡æ ·æˆ–ä¸‹é‡‡æ ·æ“ä½œæ—¶ã€‚   </span></p><p><span>---GPT4ç”Ÿæˆå†…å®¹</span></p></blockquote><p><span>è€Œå…¶ä»–æƒ…å†µåˆ™æ˜¯è°ƒç”¨å¯¹åº”çš„æ¨¡å‹é¢„æµ‹å¾—åˆ°å¯¹åº”å›¾åƒï¼Œç„¶åvae encodeè·å¾—samplesã€‚Upscaleré˜¶æ®µäº§ç”Ÿçš„samplesä¸ºimg2imgé˜¶æ®µçš„è¾“å…¥ï¼›è¯¦ç»†ä»£ç å¦‚ä¸‹ï¼š</span></p><p><img src="http://devops-1255386119.cos.ap-beijing.myqcloud.com/2023-07-13-054302.png" referrerpolicy="no-referrer" alt="image-20230712210733311"></p><p><span>å…¶ä¸­upscalerç”¨åˆ°äº†</span><a href='https://github.com/xinntao/Real-ESRGAN'><span>Real-ESRGAN</span></a><span>,æ¨¡å‹åˆ—è¡¨å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.326416px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">get_realesrgan_models</span>(<span class="cm-variable">scaler</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">try</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">from</span> <span class="cm-variable">basicsr</span>.<span class="cm-property">archs</span>.<span class="cm-property">rrdbnet_arch</span> <span class="cm-keyword">import</span> <span class="cm-variable">RRDBNet</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">from</span> <span class="cm-variable">realesrgan</span>.<span class="cm-property">archs</span>.<span class="cm-property">srvgg_arch</span> <span class="cm-keyword">import</span> <span class="cm-variable">SRVGGNetCompact</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">models</span> <span class="cm-operator">=</span> [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">UpscalerData</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">"R-ESRGAN General 4xV3"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">path</span><span class="cm-operator">=</span><span class="cm-string">"https://github.com/xinntao/Real-ESRGAN/releases/download/v0.2.5.0/realesr-general-x4v3.pth"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">4</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">upscaler</span><span class="cm-operator">=</span><span class="cm-variable">scaler</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">model</span><span class="cm-operator">=</span><span class="cm-keyword">lambda</span>: <span class="cm-variable">SRVGGNetCompact</span>(<span class="cm-variable">num_in_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_out_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_feat</span><span class="cm-operator">=</span><span class="cm-number">64</span>, <span class="cm-variable">num_conv</span><span class="cm-operator">=</span><span class="cm-number">32</span>, <span class="cm-variable">upscale</span><span class="cm-operator">=</span><span class="cm-number">4</span>, <span class="cm-variable">act_type</span><span class="cm-operator">=</span><span class="cm-string">'prelu'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">UpscalerData</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">"R-ESRGAN General WDN 4xV3"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">path</span><span class="cm-operator">=</span><span class="cm-string">"https://github.com/xinntao/Real-ESRGAN/releases/download/v0.2.5.0/realesr-general-wdn-x4v3.pth"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">4</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">upscaler</span><span class="cm-operator">=</span><span class="cm-variable">scaler</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">model</span><span class="cm-operator">=</span><span class="cm-keyword">lambda</span>: <span class="cm-variable">SRVGGNetCompact</span>(<span class="cm-variable">num_in_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_out_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_feat</span><span class="cm-operator">=</span><span class="cm-number">64</span>, <span class="cm-variable">num_conv</span><span class="cm-operator">=</span><span class="cm-number">32</span>, <span class="cm-variable">upscale</span><span class="cm-operator">=</span><span class="cm-number">4</span>, <span class="cm-variable">act_type</span><span class="cm-operator">=</span><span class="cm-string">'prelu'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">UpscalerData</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">"R-ESRGAN AnimeVideo"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">path</span><span class="cm-operator">=</span><span class="cm-string">"https://github.com/xinntao/Real-ESRGAN/releases/download/v0.2.5.0/realesr-animevideov3.pth"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">4</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">upscaler</span><span class="cm-operator">=</span><span class="cm-variable">scaler</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">model</span><span class="cm-operator">=</span><span class="cm-keyword">lambda</span>: <span class="cm-variable">SRVGGNetCompact</span>(<span class="cm-variable">num_in_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_out_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_feat</span><span class="cm-operator">=</span><span class="cm-number">64</span>, <span class="cm-variable">num_conv</span><span class="cm-operator">=</span><span class="cm-number">16</span>, <span class="cm-variable">upscale</span><span class="cm-operator">=</span><span class="cm-number">4</span>, <span class="cm-variable">act_type</span><span class="cm-operator">=</span><span class="cm-string">'prelu'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">UpscalerData</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">"R-ESRGAN 4x+"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">path</span><span class="cm-operator">=</span><span class="cm-string">"https://github.com/xinntao/Real-ESRGAN/releases/download/v0.1.0/RealESRGAN_x4plus.pth"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">4</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">upscaler</span><span class="cm-operator">=</span><span class="cm-variable">scaler</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">model</span><span class="cm-operator">=</span><span class="cm-keyword">lambda</span>: <span class="cm-variable">RRDBNet</span>(<span class="cm-variable">num_in_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_out_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_feat</span><span class="cm-operator">=</span><span class="cm-number">64</span>, <span class="cm-variable">num_block</span><span class="cm-operator">=</span><span class="cm-number">23</span>, <span class="cm-variable">num_grow_ch</span><span class="cm-operator">=</span><span class="cm-number">32</span>, <span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">4</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">UpscalerData</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">"R-ESRGAN 4x+ Anime6B"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">path</span><span class="cm-operator">=</span><span class="cm-string">"https://github.com/xinntao/Real-ESRGAN/releases/download/v0.2.2.4/RealESRGAN_x4plus_anime_6B.pth"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">4</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">upscaler</span><span class="cm-operator">=</span><span class="cm-variable">scaler</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">model</span><span class="cm-operator">=</span><span class="cm-keyword">lambda</span>: <span class="cm-variable">RRDBNet</span>(<span class="cm-variable">num_in_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_out_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_feat</span><span class="cm-operator">=</span><span class="cm-number">64</span>, <span class="cm-variable">num_block</span><span class="cm-operator">=</span><span class="cm-number">6</span>, <span class="cm-variable">num_grow_ch</span><span class="cm-operator">=</span><span class="cm-number">32</span>, <span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">4</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">UpscalerData</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">"R-ESRGAN 2x+"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">path</span><span class="cm-operator">=</span><span class="cm-string">"https://github.com/xinntao/Real-ESRGAN/releases/download/v0.2.1/RealESRGAN_x2plus.pth"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">2</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">upscaler</span><span class="cm-operator">=</span><span class="cm-variable">scaler</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">model</span><span class="cm-operator">=</span><span class="cm-keyword">lambda</span>: <span class="cm-variable">RRDBNet</span>(<span class="cm-variable">num_in_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_out_ch</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">num_feat</span><span class="cm-operator">=</span><span class="cm-number">64</span>, <span class="cm-variable">num_block</span><span class="cm-operator">=</span><span class="cm-number">23</span>, <span class="cm-variable">num_grow_ch</span><span class="cm-operator">=</span><span class="cm-number">32</span>, <span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">models</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">except</span> <span class="cm-variable">Exception</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print</span>(<span class="cm-string">"Error making Real-ESRGAN models list:"</span>, <span class="cm-variable">file</span><span class="cm-operator">=</span><span class="cm-variable">sys</span>.<span class="cm-property">stderr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print</span>(<span class="cm-variable">traceback</span>.<span class="cm-property">format_exc</span>(), <span class="cm-variable">file</span><span class="cm-operator">=</span><span class="cm-variable">sys</span>.<span class="cm-property">stderr</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1156px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1156px;"></div></div></div></pre><h4 id='diffusersä¸­åº”è¯¥å¦‚ä½•å®ç°'><span>diffusersä¸­åº”è¯¥å¦‚ä½•å®ç°</span></h4><p><span>å…¶å®å¾ˆç®€å•ï¼Œè·Ÿsd webuiä¸€æ ·ï¼ŒæŠŠæ–‡ç”Ÿå›¾çš„ç»“æœupscalerç„¶åæ”¾åˆ°å›¾ç”Ÿå›¾å†è·‘ä¸€ä¸‹å°±å¥½äº†ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.111112px; left: 7.326416px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">torch</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">torch</span> <span class="cm-keyword">import</span> <span class="cm-variable">autocast</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">diffusers</span> <span class="cm-keyword">import</span> <span class="cm-variable">EulerAncestralDiscreteScheduler</span>,<span class="cm-variable">StableDiffusionPipeline</span>,<span class="cm-variable">StableDiffusionImg2ImgPipeline</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">transformers</span> <span class="cm-keyword">import</span> <span class="cm-variable">CLIPImageProcessor</span>, <span class="cm-variable">CLIPProcessor</span>, <span class="cm-variable">CLIPTextModel</span>,<span class="cm-variable">CLIPTokenizer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">diffusers</span>.<span class="cm-property">utils</span> <span class="cm-keyword">import</span> <span class="cm-variable">get_class_from_dynamic_module</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">stablepipeline</span> <span class="cm-operator">=</span> <span class="cm-variable">StableDiffusionPipeline</span>.<span class="cm-property">from_ckpt</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"/data/stable-diffusion-webui/models/Stable-diffusion/majicmixRealistic_v6.safetensors"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">).<span class="cm-property">to</span>(<span class="cm-string">"cuda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">LPWStableDiffusionPipeline</span> <span class="cm-operator">=</span> <span class="cm-variable">get_class_from_dynamic_module</span>(<span class="cm-string">"lpw_stable_diffusion"</span>, <span class="cm-variable">module_file</span><span class="cm-operator">=</span><span class="cm-string">"lpw_stable_diffusion.py"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">text2img</span> <span class="cm-operator">=</span> <span class="cm-variable">LPWStableDiffusionPipeline</span>(<span class="cm-operator">**</span><span class="cm-variable">stablepipeline</span>.<span class="cm-property">components</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">text2img</span>.<span class="cm-property">scheduler</span> <span class="cm-operator">=</span> <span class="cm-variable">EulerAncestralDiscreteScheduler</span>.<span class="cm-property">from_config</span>(<span class="cm-variable">text2img</span>.<span class="cm-property">scheduler</span>.<span class="cm-property">config</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">text2img</span>.<span class="cm-property">safety_checker</span> <span class="cm-operator">=</span> <span class="cm-keyword">None</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">text2img</span>.<span class="cm-property">to</span>(<span class="cm-string">"cuda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">prompt</span> <span class="cm-operator">=</span> <span class="cm-string">"1girl"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">generator</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">Generator</span>(<span class="cm-variable">device</span><span class="cm-operator">=</span><span class="cm-string">"cuda"</span>).<span class="cm-property">manual_seed</span>(<span class="cm-number">1432216924</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">img2img</span> <span class="cm-operator">=</span> <span class="cm-variable">StableDiffusionImg2ImgPipeline</span>(<span class="cm-operator">**</span><span class="cm-variable">text2img</span>.<span class="cm-property">components</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">with</span> <span class="cm-variable">autocast</span>(<span class="cm-string">"cuda"</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">images</span> <span class="cm-operator">=</span> <span class="cm-variable">text2img</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">prompt</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">512</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">512</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_images_per_prompt</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">generator</span><span class="cm-operator">=</span><span class="cm-variable">generator</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">#negative_prompt = negative_prompt,</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_inference_steps</span><span class="cm-operator">=</span><span class="cm-number">20</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">guidance_scale</span><span class="cm-operator">=</span><span class="cm-number">7</span>).<span class="cm-property">images</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è¿™é‡Œå·æ‡’äº†,åªæ˜¯æŠŠå›¾ç‰‡æ‹‰ä¼¸äº†ï¼Œå…¶å®å®Œå…¨å¯æŠ„ä¸€ä¸‹sd webuiçš„ä»£ç </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">images</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-variable">images</span>[<span class="cm-number">0</span>].<span class="cm-property">resize</span>((<span class="cm-number">512</span><span class="cm-operator">*</span><span class="cm-number">2</span>, <span class="cm-number">512</span><span class="cm-operator">*</span><span class="cm-number">2</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">with</span> <span class="cm-variable">autocast</span>(<span class="cm-string">"cuda"</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">images</span> <span class="cm-operator">=</span> <span class="cm-variable">img2img</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">prompt</span><span class="cm-operator">=</span><span class="cm-string">"1girl"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">image</span><span class="cm-operator">=</span><span class="cm-variable">images</span>[<span class="cm-number">0</span>],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">strength</span><span class="cm-operator">=</span><span class="cm-number">0.7</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_inference_steps</span><span class="cm-operator">=</span><span class="cm-number">20</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">guidance_scale</span><span class="cm-operator">=</span><span class="cm-number">7</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_images_per_prompt</span><span class="cm-operator">=</span><span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">generator</span><span class="cm-operator">=</span><span class="cm-variable">generator</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ).<span class="cm-property">images</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">images</span>[<span class="cm-number">0</span>]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1089px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1089px;"></div></div></div></pre><h3 id='ç›¸å¯¹äºsd-webuiçš„ä¼˜ç¼ºç‚¹'><span>ç›¸å¯¹äºsd webuiçš„ä¼˜ç¼ºç‚¹</span></h3><p><span>ä»£ç ç»“æ„ç®€å•ã€æ¸…æ™°ã€äºŒæ¬¡å¼€å‘ç®€å•ã€æ”¯æŒ</span><a href='https://huggingface.co/docs/diffusers/v0.18.2/en/training/distributed_inference#accelerate'><span>å¤šå¡åˆ†å¸ƒå¼æ¨ç†</span></a></p><p><a href='https://github.com/AUTOMATIC1111/stable-diffusion-webui/discussions/1621'><span>sd webuiå¤šæ˜¾å¡æ”¯æŒæƒ…å†µ</span></a></p><p><span>ä¸å¦‚sd webui åŠŸèƒ½é½å…¨ã€å¾ˆå¤šåŠŸèƒ½éœ€è¦è‡ªè¡Œç»„åˆï¼Œéå¼€ç®±å³ç”¨ æ¯”å¦‚é¢éƒ¨ä¿®å¤ã€Hires.fixç­‰</span></p><p><span>å¦‚æœè¦ç”¨diffuserså¤ç°sd webuiçš„åŠŸèƒ½è‚¯å®šæ˜¯å¯è¡Œçš„ï¼Œä¸è¿‡è¦æœ‰äº›å·¥ä½œé‡ã€‚å¥½çš„æ–¹é¢æ˜¯ç›®å‰diffusersç¤¾åŒºéå¸¸æ´»è·ƒã€æ›´æ–°é€Ÿåº¦å¾ˆå¿«ã€‚</span></p><h2 id='å†™åœ¨æœ€å'><span>å†™åœ¨æœ€å</span></h2><p><span>ä»¥ä¸Šç®—æ˜¯å¯¹äºstable diffusionä»¥åŠdiffusersä¸€ä¸ªçŸ­æœŸçš„å­¦ä¹ æ€»ç»“ï¼Œç”±äºæœ¬äººæ˜¯éç®—æ³•èƒŒæ™¯ï¼Œå¾ˆå¤šåœ°æ–¹è¿˜åœ¨å­¦ä¹ ä¸­ï¼Œéš¾å…æœ‰å¾ˆå¤šä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæœ‰ä»»ä½•é—®é¢˜æ¬¢è¿éšæ—¶æŒ‡å‡ºã€‚</span></p><p><span>å¦å¤–æœ¬æ–‡æœ‰å¾ˆå¤šåœ°æ–¹æ²¡æœ‰æåˆ°ï¼Œæ¯”å¦‚controlnetã€unclipã€éƒ¨ç½²ã€è®­ç»ƒç­‰ï¼Œæœ‰éœ€è¦æˆ–è€…æœ‰ç²¾åŠ›å†å¡«å‘ã€‚</span></p><h2 id='é™„1-stable-diffusion-webui--diffuserså®‰è£…'><span>é™„1 stable diffusion webui &amp;&amp; diffuserså®‰è£…</span></h2><pre class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" spellcheck="false" lang="bash" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap CodeMirror-focused" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 453.555577px; left: 372.031264px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">yum install <span class="cm-attribute">-y</span> <span class="cm-builtin">git</span> python3-opencv</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">wget</span> https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">bash</span> Miniconda3-latest-Linux-x86_64.sh <span class="cm-attribute">-b</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">mkdir</span> /data</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mount /dev/vdb /data</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda create <span class="cm-attribute">-n</span> sd-webui <span class="cm-def">python</span><span class="cm-operator">=</span><span class="cm-number">3</span>.10</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda activate sd-webui</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> clone https://github.com/AUTOMATIC1111/stable-diffusion-webui.git</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> stable-diffusion-webui</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">sed</span> <span class="cm-attribute">-i</span> <span class="cm-string">'s/can_run_as_root=0/can_run_as_root=1/g'</span> webui.sh &amp;&amp; ./webui.sh </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda create <span class="cm-attribute">-n</span> py3.8 <span class="cm-def">python</span><span class="cm-operator">==</span><span class="cm-number">3</span>.8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda activate py3.8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda update <span class="cm-attribute">-y</span> conda</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda install <span class="cm-attribute">-y</span> numpy matplotlib pandas </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda install pytorch torchvision torchaudio <span class="cm-def">pytorch-cuda</span><span class="cm-operator">=</span><span class="cm-number">11</span>.7 <span class="cm-attribute">-c</span> pytorch <span class="cm-attribute">-c</span> nvidia</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda install <span class="cm-attribute">-c</span> huggingface transformers diffusers</span></pre><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda install <span class="cm-attribute">-y</span> jupyter notebook requests</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 467px;"></div><div class="CodeMirror-gutters" style="display: none; height: 467px;"></div></div></div></pre><h2 id='é™„2-å¼€å‘ç¯å¢ƒ'><span>é™„2 å¼€å‘ç¯å¢ƒ</span></h2><p><span>ä»¥ä¸Šå®ä¾‹ä»£ç éƒ½æ˜¯åœ¨jupter notebookä¸­å¯è¿è¡Œçš„ã€‚å¦‚ä»¥å…¶ä»–æ–¹å¼è¿è¡Œï¼Œéœ€è¦åšäº›å˜æ›´ã€‚</span></p><h2 id='é™„3-ä¸€äº›å‚è€ƒé“¾æ¥'><span>é™„3 ä¸€äº›å‚è€ƒé“¾æ¥</span></h2><ul><li><p><a href='https://afoo.me/posts/2023-04-29-stablediffusion-webui-alternatives.html'><span>ä¸çŸ¥é“Stable Diffusion Web UIåº”è¯¥æ€ä¹ˆé€‰ï¼Ÿ çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼</span></a></p></li><li><p><a href='https://huggingface.co/blog/controlnet' target='_blank' class='url'>https://huggingface.co/blog/controlnet</a></p></li><li><p><a href='https://pytorch.org/blog/accelerated-diffusers-pt-20/' target='_blank' class='url'>https://pytorch.org/blog/accelerated-diffusers-pt-20/</a></p></li><li><p><a href='https://huggingface.co/docs/diffusers/v0.18.2/en/training/distributed_inference#accelerate' target='_blank' class='url'>https://huggingface.co/docs/diffusers/v0.18.2/en/training/distributed_inference#accelerate</a></p></li><li><p><a href='https://huggingface.co/blog/stable_diffusion#how-does-stable-diffusion-work'><span>https://huggingface.co/blog/stable_diffusion#how-does-stable-diffusion-work</span></a></p></li></ul><p><span>è‹¥æœ‰æ ¼å¼é—®é¢˜æˆ–è€…åç»­æ›´æ–°ï¼Œå¯è§åŸæ–‡ã€‚</span><a href='https://binnn6.github.io/posts/diffusers%E8%B0%83%E7%A0%94.html'><span>ğŸ¤— DğŸ§¨ ffusersè°ƒç ”</span></a></p><p>&nbsp;</p></div></div>

<script>(function (){var e=document.body.parentElement,t=[],n=null,i=document.body.classList.contains("typora-export-collapse-outline"),r=function(e,t,n){document.addEventListener(e,function(e){if(!e.defaultPrevented)for(var i=e.target;i&&i!=this;i=i.parentNode)if(i.matches(t)){!1===n.call(i,e)&&(e.preventDefault(),e.stopPropagation());break}},!1)};function o(){return e.scrollTop}r("click",".outline-expander",function(e){var t=this.closest(".outline-item-wrapper").classList;return t.contains("outline-item-open")?t.remove("outline-item-open"):t.add("outline-item-open"),d(),!1}),r("click",".outline-item",function(e){var t=this.querySelector(".outline-label");if(location.hash="#"+t.getAttribute("href"),i){var n=this.closest(".outline-item-wrapper").classList;n.contains("outline-item-open")||n.add("outline-item-open"),c(),n.add("outline-item-active")}});var a,s,l=function(){var e=o();n=null;for(var i=0;i<t.length&&t[i][1]-e<60;i++)n=t[i]},c=function(){document.querySelectorAll(".outline-item-active").forEach(e=>e.classList.remove("outline-item-active")),document.querySelectorAll(".outline-item-single.outline-item-open").forEach(e=>e.classList.remove("outline-item-open"))},d=function(){if(n){c();var e=document.querySelector('.outline-label[href="#'+(CSS.escape?CSS.escape(n[0]):n[0])+'"]');if(e)if(i){var t=e.closest(".outline-item-open>ul>.outline-item-wrapper");if(t)t.classList.add("outline-item-active");else{for(var r=(e=e.closest(".outline-item-wrapper")).parentElement.closest(".outline-item-wrapper");r;)r=(e=r).parentElement.closest(".outline-item-wrapper");e.classList.add("outline-item-active")}}else e.closest(".outline-item-wrapper").classList.add("outline-item-active")}};window.addEventListener("scroll",function(e){a&&clearTimeout(a),a=setTimeout(function(){l(),d()},300)});var u=function(){s=setTimeout(function(){!function(){t=[];var e=o();document.querySelector("#write").querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(n=>{var i=n.getAttribute("id");t.push([i,e+n.getBoundingClientRect().y])})}(),l(),d()},300)};window.addEventListener("resize",function(e){s&&clearTimeout(s),u()}),u()})();</script></body>
</html>